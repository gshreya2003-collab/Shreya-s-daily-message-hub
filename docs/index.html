<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Daily Oracle — Blessing Stone</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;700&family=Playfair+Display:wght@400;600&display=swap" rel="stylesheet">
<style>
  :root{
    --bg-a: #C9D7FF;  /* soft blue */
    --bg-b: #FDE2FF;  /* soft pink */
    --bg-c: #F5E4FF;  /* lavender */
    --card-bg: rgba(255,255,255,0.92);
    --ink: #2b2430;
    --muted:#6e6470;
    --accent: #7A5CFF;
    --max-width: 900px;
  }
  html,body{height:100%;margin:0;font-family:Nunito,system-ui,-apple-system,Arial;color:var(--ink);-webkit-font-smoothing:antialiased}
  body{
    background: linear-gradient(180deg,var(--bg-a),var(--bg-b),var(--bg-c));
    display:flex;align-items:center;justify-content:center;padding:20px;
  }

  /* page container */
  .wrap{
    width:100%; max-width:var(--max-width);
    border-radius:16px; overflow:visible;
    position:relative;
    min-height:70vh;
    box-shadow: 0 30px 70px rgba(30,20,60,0.12);
    background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
    padding:28px;
    box-sizing:border-box;
  }

  /* sparkles layer (absolute) */
  .sparkles {
    position:absolute; inset:0; pointer-events:none; z-index:1; overflow:visible;
  }
  .sparkle {
    position:absolute; width:12px; height:12px; border-radius:50%;
    background: rgba(255,255,255,0.85); box-shadow:0 0 12px rgba(255,255,255,0.7);
    opacity:0; transform: translateY(0) scale(.6);
  }
  /* generate different sizes using classes */
  .s--small{width:8px;height:8px}
  .s--mid{width:12px;height:12px}
  .s--big{width:18px;height:18px}

  /* gentle float + fade animation for sparkles */
  @keyframes sparkleFloat {
    0% { transform: translateY(0) scale(.85); opacity:0; }
    10% { opacity:0.9; }
    50% { transform: translateY(-26px) scale(1.05); opacity:0.7; }
    90% { opacity:0.0; }
    100% { transform: translateY(-40px) scale(.9); opacity:0; }
  }

  /* content centre */
  .content {
    position:relative; z-index:3;
    display:flex; flex-direction:column; align-items:center; gap:18px;
    text-align:center; padding:28px;
  }

  .logo {
    font-family: "Playfair Display", serif;
    font-size:30px; font-weight:700; color:var(--accent);
    background: var(--card-bg);
    padding:12px 18px; border-radius:12px;
    box-shadow: 0 10px 30px rgba(40,30,80,0.06);
  }

  .subtitle { color:var(--muted); font-size:14px; max-width:72%; margin:0 auto; }

  /* message card */
  .message-card {
    margin-top:6px;
    background: var(--card-bg);
    border-radius:14px;
    padding:18px 20px;
    box-shadow: 0 18px 46px rgba(30,20,60,0.06);
    max-width:720px; width:100%;
  }
  .message-text {
    font-family: "Playfair Display", serif;
    font-size:20px; line-height:1.5; color:var(--ink);
    margin:0;
    white-space:pre-wrap;
  }
  .meta { margin-top:10px; color:var(--muted); font-size:13px; }

  /* small "another" button if you want */
  .controls { margin-top:12px; display:flex; gap:10px; justify-content:center; }
  .btn {
    background: linear-gradient(180deg,var(--accent), #ff77c7);
    color:white; padding:10px 14px; border-radius:12px; border:0; font-weight:700; cursor:pointer;
    box-shadow: 0 10px 30px rgba(120,80,200,0.12);
  }
  .btn--ghost { background:transparent; border:1px solid rgba(30,20,40,0.06); color:var(--ink) }

  /* small footnote */
  .foot { margin-top:12px; font-size:12px; color:var(--muted) }

  /* responsive */
  @media (max-width:640px){
    .wrap{ padding:18px; border-radius:12px; min-height:60vh }
    .message-text{ font-size:18px }
    .subtitle{ max-width:90% }
    .logo{ font-size:26px }
  }
</style>
</head>
<body>
  <div class="wrap" role="main" aria-live="polite">
    <div class="sparkles" id="sparkles"></div>

    <div class="content">
      <div class="logo">DAILY ORACLE</div>
      <p class="subtitle">Tap your blessing stone — a message will appear as the page opens.</p>

      <div class="message-card" id="messageCard" aria-live="polite" aria-atomic="true">
        <div class="message-text" id="messageText">Loading your message…</div>
        <div class="meta" id="metaText"></div>
      </div>

      <div class="controls">
        <button class="btn" id="anotherBtn">Show another</button>
        <button class="btn btn--ghost" id="shareBtn">Copy URL</button>
      </div>

      <div class="foot">Tip: program your NFC tag to open this page. Each tap shows a new, random message.</div>
    </div>
  </div>

<script>
/*
 Behavior:
 - On page load, try to fetch messages from /data/blessings.json (expected: ["msg1","msg2",...])
 - If fetch succeeds, pick one random message and show immediately.
 - If fetch fails (no JSON present), fall back to small built-in array.
 - 'Show another' picks a new random message without needing reload.
 - Sparkles are purely CSS/JS placed elements animated with staggered time.
*/

// Helper: show message
function showMessage(text, idx, total){
  document.getElementById('messageText').innerText = text || 'No message found.';
  document.getElementById('metaText').innerText = total ? `Message ${idx+1} of ${total}` : '';
}

// Random index
function randInt(max){ return Math.floor(Math.random() * max); }

// Load messages (try external JSON then fallback)
let MESSAGES = [
  "May your steps today be gentle and sure.",
  "A small kindness will bring an unexpected joy.",
  "Listen to the quiet — it holds your next hint.",
  "Your patience plants the seed for something bright."
];

async function loadMessages(){
  try{
    const res = await fetch('./data/blessings.json?cache=' + Date.now());
    if(!res.ok) throw new Error('no json');
    const data = await res.json();
    // Accept either array of strings, or object with values array
    if(Array.isArray(data) && data.length>0){
      MESSAGES = data;
    } else if(data && Array.isArray(data.values) && data.values.length>0){
      // in case Google Sheets published format
      MESSAGES = data.values.flat();
    } else {
      console.warn('JSON found but not in expected format. Using fallback messages.');
    }
  }catch(e){
    // fallback remains
    console.info('No external blessings.json found — using built-in messages.');
  }
}

// Pick and display a random message
function pickAndShow(){
  if(!MESSAGES || MESSAGES.length===0) {
    showMessage("No messages available.");
    return;
  }
  const idx = randInt(MESSAGES.length);
  showMessage(MESSAGES[idx], idx, MESSAGES.length);
}

// "Another" button behaviour
document.getElementById('anotherBtn').addEventListener('click', ()=>{
  pickAndShow();
  // add small pulse to card
  const c = document.getElementById('messageCard');
  c.animate([{transform:'scale(1)'},{transform:'scale(1.02)'},{transform:'scale(1)'}], {duration:280});
});

// copy URL (useful for NFC testing)
document.getElementById('shareBtn').addEventListener('click', async ()=>{
  try{
    await navigator.clipboard.writeText(location.href);
    const old = document.getElementById('metaText').innerText;
    document.getElementById('metaText').innerText = 'URL copied to clipboard';
    setTimeout(()=>document.getElementById('metaText').innerText = old, 1500);
  }catch(e){ alert('Could not copy URL'); }
});

// generate sparkles (positions + animation delays randomized)
function makeSparkles(count=20){
  const wrap = document.getElementById('sparkles');
  wrap.innerHTML = '';
  for(let i=0;i<count;i++){
    const s = document.createElement('div');
    s.className = 'sparkle ' + (i%3===0 ? 's--big' : (i%2 ? 's--mid' : 's--small'));
    // random position within the wrap
    const left = Math.random() * 98;
    const top = Math.random() * 62; // keep sparkles mainly in upper area
    s.style.left = left + '%';
    s.style.top = top + '%';
    // random animation delay & duration
    const dur = (3.5 + Math.random()*3).toFixed(2) + 's';
    const delay = (Math.random()*2).toFixed(2) + 's';
    s.style.animation = `sparkleFloat ${dur} ease-in-out ${delay} infinite`;
    // subtle color variations (white, very pale pink, pale lavender)
    const tone = Math.random();
    if(tone < 0.28) s.style.background = 'rgba(255,255,255,0.95)';
    else if(tone < 0.6) s.style.background = 'rgba(255,240,250,0.95)';
    else s.style.background = 'rgba(245,240,255,0.95)';
    wrap.appendChild(s);
  }
}

// initialize on load
window.addEventListener('DOMContentLoaded', async ()=>{
  makeSparkles(18);               // create sparkles
  await loadMessages();           // try loading external JSON
  pickAndShow();                  // show one immediately
});
</script>
</body>
</html>
